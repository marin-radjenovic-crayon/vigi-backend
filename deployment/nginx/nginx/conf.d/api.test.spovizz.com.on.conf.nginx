upstream loadbalancer {
   server spovizz_api:8080 weight=5;
#    server bvr_bvr-prod_2:8080 weight=5;
}

server {
   listen 443 ssl;
   server_name api.test.spovizz.com www.api.test.spovizz.com;

   ssl_certificate /etc/letsencrypt/live/api.test.spovizz.com/fullchain.pem;
   ssl_certificate_key /etc/letsencrypt/live/api.test.spovizz.com/privkey.pem;

   ssl_prefer_server_ciphers on;
   ssl_ciphers "EECDH+ECDSA+AESGCM EECDH+aRSA+AESGCM EECDH+ECDSA+SHA384 EECDH+ECDSA+SHA256 EECDH+aRSA+SHA384 EECDH+aRSA+SHA256 EECDH+aRSA+RC4 EECDH EDH+aRSA RC4 !aNULL !eNULL !LOW !3DES !MD5 !EXP !PSK !SRP !DSS";
   add_header X-Frame-Options "SAMEORIGIN";
   add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload";
   ssl_protocols TLSv1.2 TLSv1.3;

   ssl_dhparam /etc/ssl/certs/dhparam.pem;

   # include conf.d/partials/letsencrypt.conf;

#    root /usr/share/nginx/html/video.spovizz;

   location / {
       proxy_pass http://spovizz_api:8080;
   }

   if ($host = www.$server_name) {
      rewrite ^(.*) https://$server_name$request_uri? permanent;
   }
}
