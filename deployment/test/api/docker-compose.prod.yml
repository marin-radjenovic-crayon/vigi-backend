version: '3'
services:
  spovizz_api:
    container_name: ${INSTANCEID}
    restart: always
    image: h2908577.stratoserver.net:5001/spovizz/${INSTANCEID}:1.0.2
#    image: ${INSTANCEID}:latest
    env_file:
      - .env.prod.test
#    build:
#      dockerfile: Dockerfile
#      context: ""
    ports:
     - '15010:8080'
    volumes:
      - /data/docker-data/adler/screenshots:/usr/src/app/public/screenshots
      - /data/docker-data/adler/upload:/usr/src/app/public/upload
  spovizz_chrome:
    command: [ 'sh', 'run.sh' ]
    image: spovizz_chrome
    build:
      context: "./chrome"
      dockerfile: "./Dockerfile"
#    ports:
#      - 9222:9222
    environment:
      - TZ=Europe/Berlin
#    networks:
#      default:
#        ipv4_address: 172.18.0.50
    #network_mode: host
#    ports:
#      - "10000-10005:9222"
#    cap_add:
#      - SYS_ADMIN
    shm_size: 2gb
    security_opt:
      - seccomp:./chrome/security-opt-chrome.json
  spovizz_mongo:
    container_name: "spovizz-mongo"
    image: mongo
#    ports:
#      - '28000:27017'
#  redis:
#    container_name: redis
#    image: redis:alpine
#    ports:
#      - '6379:6379'
networks:
  default:
    external:
      name: live_network
